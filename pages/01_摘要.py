import streamlit as st
import pandas as pd
import numpy as np
# import openpyxl
import xlrd

import cv2
from streamlit_webrtc import webrtc_streamer, WebRtcMode


st.title("摘要")

st.write("課程以 ROS（Robot Operating System） 為核心平台，整合人工智慧、電腦視覺、強化學習與人機介面技術，建構一套智慧機械系統之整合實作架構。研究內容首先以 TurtleBot3 Burger 或 Waffle 平台為基礎，完成自主導航與避障功能，驗證行動機器人在已知與未知環境中的基本移動能力。其次，透過深度學習影像分類模型，結合 RViz 與即時攝影機影像，實現左轉、右轉、前進、後退與停止等指令動作之辨識與判斷，提升人機互動的直覺性。在影像辨識應用方面，本研究採用 Ultralytics YOLO 模型進行物件辨識，針對杏鮑菇及其他自選蔬果類別進行訓練與測試，並進一步結合 SAM（Segment Anything Model）完成影像分割與物件數量統計，展現深度學習於工業與農業視覺應用之潛力。此外，本研究亦建立三連桿平面機械手臂之強化學習模型，透過模擬環境完成控制策略之訓練與驗證，以說明強化學習於機械系統控制上的可行性。最後，整合大型語言模型（LLM）與 ROS 架構，實作語意層級之控制與模擬操作，並以 Streamlit 建立網頁式操作介面，將各項功能進行整合展示與測試。透過本研究之實作成果，證明 ROS 與 AI 技術整合於智慧機械設計中的實用性與擴充性，並提供未來智慧製造與機器人應用之參考方向。")

# ========== [start] 以下為實驗報告基本架構 ==============

# 在這裡添加實驗一的具體內容，如圖表、數據等
st.header("1.1 電腦視覺概論")
st.write("電腦視覺（Computer Vision）為人工智慧領域中重要的研究方向之一，其主要目的在於使電腦或機器能夠透過影像或影像序列，理解環境中的物體、位置與動作資訊，進而輔助決策或執行控制任務。隨著影像感測設備與運算能力的提升，電腦視覺技術已逐漸從早期的影像處理方法，發展為結合深度學習之智慧感知系統。電腦視覺系統通常包含影像擷取、前處理、特徵萃取與影像理解等流程。透過攝影機、深度感測器或其他視覺裝置取得影像後，系統會先進行影像強化、去雜訊或尺寸正規化等前處理，再利用傳統影像特徵或深度學習模型進行分析。近年來，卷積神經網路（Convolutional Neural Network, CNN）在影像分類、物件偵測與影像分割等任務中展現優異表現，大幅提升電腦視覺系統的辨識準確率與即時性。在智慧機械與機器人應用中，電腦視覺扮演著「感知系統」的角色，使機器能夠即時掌握周遭環境狀態。透過影像辨識與空間理解技術，機器人不僅能辨識物體種類，也能推估其位置與相對關係，進而支援導航、避障、物件操作與人機互動等功能。")


st.header("1.2 電腦視覺之產業應用")
st.write("隨著人工智慧與深度學習技術的成熟，電腦視覺已被廣泛應用於各種產業領域。在製造業中，電腦視覺常被用於自動化檢測、瑕疵辨識與尺寸量測，可取代傳統人工目視檢查，提升生產效率與品質穩定度。此外，在智慧工廠環境中，視覺系統亦可結合機器人進行物件定位與抓取，強化產線的彈性與自動化程度。在機器人與自走車應用方面，電腦視覺可提供環境感知資訊，協助系統進行路徑規劃、障礙物辨識與行為判斷。透過即時影像分析，機器人能夠辨識指示標誌、物體或人類動作，提升人機協作的安全性與互動性。於農業領域中，電腦視覺亦可應用於作物辨識、成熟度判斷與數量統計，協助實現智慧農業之目標。在日常生活與服務產業方面，電腦視覺技術已廣泛應用於臉部辨識、智慧監控、無人商店及物流系統等場景。隨著演算法效能與硬體設備持續進步，電腦視覺在各產業中的應用範圍將持續擴展，並成為智慧機械與智慧系統中不可或缺的核心技術之一。")



# ==================================================================

# 利用 Streamlit 顯示即時攝影機影像的步驟與範例 Python 程式碼：
# 記得安裝opencv-python, streamlit_webrtc套件
def main():
    st.title("即時 Webcam 影像顯示")
    st.write("本應用展示如何在 Streamlit 中顯示即時攝影機影像。")
    
    # 方法一：啟動攝影機
    webrtc_streamer(key="example", mode=WebRtcMode.SENDRECV)
    
    # 方法二：啟動 OpenCV 攝影機擷取
    cap = cv2.VideoCapture(0)
    
    stframe = st.empty()  # 用於動態顯示影像的占位符
    
    while True:
        ret, frame = cap.read()
        if not ret:
            st.error("無法讀取攝影機影像")
            break
        
        # OpenCV 的 BGR 格式轉換為 RGB 格式
        frame = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)
        
        # 使用 Streamlit 顯示影像
        stframe.image(frame, channels="RGB", use_column_width=True)
    
    # 釋放攝影機資源
    cap.release()

if __name__ == "__main__":
    main()
